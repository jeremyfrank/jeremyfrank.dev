---
import { promisify } from 'util'
import sizeOf from 'image-size'
import { clients } from '../data/clients.js'

const allClients = clients.sort((a, b) => {
  var nameA = a.name.toUpperCase()
  var nameB = b.name.toUpperCase()
  return nameA < nameB ? -1 : nameA > nameB ? 1 : 0
})

const featuredClients = allClients.filter((item) => item.image)
const remainingClients = allClients.filter((item) => !item.image)
const getSizeOf = promisify(sizeOf)

featuredClients.map(async (client) => {
  await getSizeOf(`./public/images/${client.image}`)
    .then((dimensions) => {
      client.width = dimensions.width
      client.height = dimensions.height
      client.aspectRatio = dimensions.height / dimensions.width
    })
    .catch((err) => console.error(err))
  return client
})
---

<section
  class="flex flex-col items-center justify-center px-5 py-20 text-center"
>
  <h2>Select Clients</h2>

  <p class="max-w-2xl mx-auto mt-4 font-serif text-xl sm:text-2xl">
    I’m proud to have worked with a wide variety of companies and organizations
    over the years. Here’s just a few of them!
  </p>

  <ul
    class="grid grid-cols-2 gap-10 mt-20 md:grid-cols-5 dark:invert dark:grayscale"
  >
    {
      featuredClients.map((client) => (
        <li class="flex flex-col items-center justify-center p-2 text-center">
          <img
            src={`/images/${client.image}`}
            loading="lazy"
            alt={client.name}
            class="max-w-[75%] max-h-[30px]"
          />
        </li>
      ))
    }
  </ul>

  <details class="mt-10 max-w-4xl space-y-10">
    <summary class="cursor-pointer select-none text-center mx-auto w-[10ch]">
      More
    </summary>

    <ul class="columns-3 sm:columns-4 gap-x-10 leading-4 text-sm text-zinc-500">
      {
        remainingClients.map((client) => (
          <li class="break-inside-avoid flex items-center justify-center py-1.5">
            {client.name}
          </li>
        ))
      }
    </ul>
  </details>
</section>
