---
import { promisify } from 'util'
import sizeOf from 'image-size'

import WorkRow from '../components/WorkRow.astro'
import '../styles/global.css'
import { clients } from '../data/clients.js'

const getSizeOf = promisify(sizeOf)
const work = (await Astro.glob('../data/work/*.md'))
  .sort((a, b) => new Date(b.frontmatter.date).valueOf() - new Date(a.frontmatter.date).valueOf())

const allClients = clients.sort((a, b) => {
  var nameA = a.name.toUpperCase()
  var nameB = b.name.toUpperCase()
  return (nameA < nameB) ? -1 : (nameA > nameB) ? 1 : 0
})

const featuredClients = allClients.filter(item => item.image)
const remainingClients = allClients.filter(item => !item.image)

featuredClients
  .map(async client => {
    await getSizeOf(`./public/images/${client.image}`)
      .then(dimensions => {
        client.width = dimensions.width
        client.height = dimensions.height
        client.aspectRatio = dimensions.height / dimensions.width
      })
      .catch(err => console.error(err))
    return client
  })
---
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>jeremyfrank.dev</title>
  </head>
  <body>
    <main>
      <section class="bg-gradient-to-br from-cyan-500 to-blue-500 p-6 sm:py-12">
        <div class="flex flex-col gap-6 sm:gap-8 justify-center min-h-max font-serif text-white max-w-4xl mx-auto leading-tight text-xl sm:text-3xl">
          <img src="/images/avatar.jpg" class="block flex-shrink-0 rounded-full h-24 w-24 sm:h-24 sm:w-24" alt="">

          <p>
            Hello, I’m Jeremy.
          </p>

          <p>
            I’m a development director at
            <a href="https://www.viget.com/" class="font-bold">Viget</a>,
            specializing in <b class="font-bold text-sky-500">user interface</b> and
            <b class="font-bold text-sky-500">design system</b> development, with a focus on
            <b class="font-bold text-sky-500">performance</b> and
            <b class="font-bold text-sky-500">accessibility</b>.
          </p>

          <p>
            Over the course of two decades, I've bridged the gap between design and engineering, working with teams to provide technical leadership and mentorship, while building cohesive and intuitive, highly performant and accessible user interfaces.
          </p>
        </div>
      </section>

      <section class="bg-slate-300 min-h-screen py-20">
        <div class="flex flex-col gap-12 items-center justify-center max-w-5xl mx-auto">
          <h2>
            Work
          </h2>

          <ul class="mt-20 space-y-40 text-left">
            {work.map((item, index) => (
              <WorkRow
                title={item.frontmatter.title}
                url={item.frontmatter.url}
                image={item.frontmatter.image}
                color={item.frontmatter.color}
                role={item.frontmatter.role}
                tech={item.frontmatter.tech}
                index={index}
              />
            ))}
          </ul>
        </div>
      </section>

      <section class="flex flex-col items-center justify-center px-5 py-20 text-center">
        <h2>
          Select Clients
        </h2>

        <p class="max-w-2xl mx-auto mt-4 font-serif text-xl sm:text-2xl">
          I’m proud to have worked with a wide variety of companies and organizations over the years. Here’s just a few of them!
        </p>

        <ul class="grid grid-cols-2 gap-10 mt-20 md:grid-cols-5">
          {featuredClients.map(client => (
            <li class="flex flex-col items-center justify-center p-2 text-center">
              <img src="/images/${client.image}" loading="lazy" alt={client.name} class="max-w-[75%] max-h-[30px]">
            </li>
          ))}
        </ul>

        <details class="mt-10 max-w-4xl">
          <summary class="cursor-pointer select-none text-center mx-auto w-[10ch]">
            More
          </summary>
          <ul class="mt-10 columns-3 sm:columns-4 gap-x-10 leading-4 text-sm text-neutral-500">
            {remainingClients.map(client => (
              <li class="break-inside-avoid flex items-center justify-center py-1">
                {client.name}
              </li>
            ))}
          </ul>
        </details>
      </section>
    </main>

    <footer class="p-5 text-center">
      <p class="border-t pt-5">
        ©
        {new Date().getFullYear()}
        Jeremy Frank
      </p>
    </footer>
  </body>
</html>
